<!DOCTYPE html>
<html>
<head>
  <title>The Traitors â€“ Display</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #display {
      width: 100%;
      max-width: 1200px;
      padding: 40px;
    }
    .fade {
      animation: fadeIn 1.2s ease-in-out;
    }
    .zoom {
      animation: zoomIn 1.2s ease-in-out;
    }
    .players {
      margin-top: 40px;
    }
    .player {
      font-size: 24px;
      margin: 12px;
      opacity: 1;
      transition: opacity 0.8s ease;
      padding: 8px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.05);
    }
    .dead {
      opacity: 0.35;
      text-decoration: line-through;
    }
    @keyframes fadeIn {
      from { 
        opacity: 0;
      }
      to { 
        opacity: 1;
      }
    }
    @keyframes zoomIn {
      from { 
        transform: scale(0.95);
        opacity: 0;
      }
      to { 
        transform: scale(1);
        opacity: 1;
      }
    }
    h1 {
      margin: 30px 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    h2 {
      margin: 20px 0;
      color: var(--gold);
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    .logo {
      max-width: 400px;
      margin: 0 auto 40px;
      display: block;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body class="center">

<div id="display" class="fade"></div>

<script>
function load() {
  return JSON.parse(localStorage.getItem("gameState"));
}

function render() {
  const d = document.getElementById("display");
  const s = load();
  d.className = "fade"; // Always use fade for smooth transitions
  d.innerHTML = "";

  if (!s || s.phase === "SETUP") {
    d.innerHTML = `<img src="traitors.jpg" class="logo">`;
    return;
  }

  if (s.phase === "MENU") {
    d.innerHTML = `
      <img src="traitors.jpg" class="logo">
      <h2>GAME MENU</h2>
    `;
  }

  if (s.phase === "MURDER") {
    const alive = s.players.filter(p => p.alive);
    const p = alive[s.index];
    d.innerHTML = `
      <h1>PLAYER ${p.id}</h1>
      <h2>PLEASE COME TO THE COMPUTER</h2>
    `;
  }

  if (s.phase === "PASS") {
    d.innerHTML = `
      <h1>PASS THE DEVICE</h1>
    `;
  }

  if (s.phase === "TALK") {
    d.innerHTML = `
      <h1>YOU HAVE 2 MINUTES TO TALK</h1>
      <h2>${formatTime(s.timer)}</h2>
    `;
  }

  if (s.phase === "BANISH") {
    const alive = s.players.filter(p => p.alive);
    const p = alive[s.index];
    d.innerHTML = `
      <h1>PLAYER ${p.id}</h1>
      <h2>PLEASE VOTE</h2>
    `;
  }

  /* PLAYER LIST */
  const list = document.createElement("div");
  list.className = "players";
  s.players.forEach(p => {
    const div = document.createElement("div");
    div.className = "player" + (p.alive ? "" : " dead");
    div.textContent = p.name || `Player ${p.id}`;
    list.appendChild(div);
  });
  d.appendChild(list);
}

function formatTime(t) {
  const m = Math.floor(t / 60);
  const s = t % 60;
  return `${m}:${s.toString().padStart(2, "0")}`;
}

window.addEventListener("storage", render);
render();
</script>

</body>
</html>
