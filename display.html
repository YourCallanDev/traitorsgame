<!DOCTYPE html>
<html>
<head>
  <title>The Traitors â€“ Display</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .fade {
      animation: fade 0.8s ease;
    }
    .zoom {
      animation: zoom 0.8s ease;
    }
    .players {
      margin-top: 30px;
    }
    .player {
      font-size: 20px;
      margin: 6px;
      opacity: 1;
      transition: opacity 0.5s;
    }
    .dead {
      opacity: 0.3;
      text-decoration: line-through;
    }
    @keyframes fade {
      from { opacity: 0 }
      to { opacity: 1 }
    }
    @keyframes zoom {
      from { transform: scale(0.8); opacity: 0 }
      to { transform: scale(1); opacity: 1 }
    }
  </style>
</head>
<body class="center">

<div id="display" class="fade"></div>

<script>
function load() {
  return JSON.parse(localStorage.getItem("gameState"));
}

function render() {
  const d = document.getElementById("display");
  const s = load();
  d.innerHTML = "";

  if (!s || s.phase === "SETUP") {
    d.innerHTML = `<img src="traitors.jpg" class="logo zoom">`;
    return;
  }

  if (s.phase === "MENU") {
    d.innerHTML = `
      <img src="traitors.jpg" class="logo zoom">
      <h2>GAME MENU</h2>
    `;
  }

  if (s.phase === "MURDER") {
    const alive = s.players.filter(p => p.alive);
    const p = alive[s.index];
    d.innerHTML = `
      <h1 class="zoom">PLAYER ${p.id}</h1>
      <h2>PLEASE COME TO THE COMPUTER</h2>
    `;
  }

  if (s.phase === "PASS") {
    d.innerHTML = `
      <h1 class="fade">PASS THE DEVICE</h1>
    `;
  }

  if (s.phase === "TALK") {
    d.innerHTML = `
      <h1 class="zoom">YOU HAVE 2 MINUTES TO TALK</h1>
      <h2>${formatTime(s.timer)}</h2>
    `;
  }

  if (s.phase === "BANISH") {
    const alive = s.players.filter(p => p.alive);
    const p = alive[s.index];
    d.innerHTML = `
      <h1>PLAYER ${p.id}</h1>
      <h2>PLEASE VOTE</h2>
    `;
  }

  /* PLAYER LIST */
  const list = document.createElement("div");
  list.className = "players";
  s.players.forEach(p => {
    const div = document.createElement("div");
    div.className = "player" + (p.alive ? "" : " dead");
    div.textContent = p.name || `Player ${p.id}`;
    list.appendChild(div);
  });
  d.appendChild(list);
}

function formatTime(t) {
  const m = Math.floor(t / 60);
  const s = t % 60;
  return `${m}:${s.toString().padStart(2, "0")}`;
}

window.addEventListener("storage", render);
render();
</script>

</body>
</html>
