<!DOCTYPE html>
<html>
<head>
  <title>Traitors – Player Input</title>
  <link rel="stylesheet" href="style.css">
  <script src="game.js"></script>
</head>
<body>

<div class="panel" id="ui"></div>

<script>
function render() {
  const s = load();
  const ui = document.getElementById("ui");
  ui.innerHTML = "";

  if (!s) {
    ui.innerHTML = `
      <h2>Initialise Game</h2>
      <input id="count" type="number" placeholder="Number of players">
      <br><br>
      <label><input type="checkbox" id="disp" checked> Use Display</label>
      <br><br>
      <button onclick="start()">START</button>`;
    return;
  }

  if (!s.adminConfirmed) {
    ui.innerHTML = `<h2>Waiting for admin to confirm game start…</h2>`;
    return;
  }

  if (s.phase === "SETUP") {
    const p = s.players.find(x => !x.name);
    if (!p) return;

    ui.innerHTML = `
      <h2>PLAYER ${p.id}</h2>
      <input id="name" placeholder="Name">
      <br>
      <select id="role">
        <option>FAITHFUL</option>
        <option>TRAITOR</option>
      </select>
      <br><br>
      <button onclick="savePlayer(${p.id})">CONFIRM</button>`;
    return;
  }

  if (s.paused) {
    ui.innerHTML = `<h2>GAME PAUSED</h2>`;
    return;
  }

  if (s.phase === "MENU") {
    ui.innerHTML = `
      <h2>Choose Next Phase</h2>
      <button onclick="startGame()">GAME</button>
      <button onclick="finalBanish()">FINAL BANISHMENT</button>`;
    return;
  }
}

function start() {
  initGame(
    Number(document.getElementById("count").value),
    document.getElementById("disp").checked
  );
  render();
}

function savePlayer(id) {
  const s = load();
  const p = s.players.find(x => x.id === id);

  p.name = document.getElementById("name").value.trim();
  p.role = document.getElementById("role").value;

  if (s.players.every(pl => pl.name && pl.role)) {
    s.phase = "MENU";
    s.message = "CHOOSE THE NEXT PHASE";
    speak("Players, please choose the next phase.");
  }

  save(s);
  render();
}

window.addEventListener("storage", render);
render();
</script>

</body>
</html>
