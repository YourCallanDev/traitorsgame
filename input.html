<!DOCTYPE html>
<html>
<head>
  <title>Traitors â€“ Player Input</title>
  <link rel="stylesheet" href="style.css">
  <script src="game.js"></script>
</head>
<body>
<div class="panel" id="ui"></div>

<script>
function render() {
  const s = load();
  const ui = document.getElementById("ui");
  ui.innerHTML = "";

  if (!s) {
    ui.innerHTML = `
      <h2>Start Game</h2>
      <input id="count" type="number" placeholder="Players">
      <label>
        <input type="checkbox" id="disp" checked> Use Display
      </label><br>
      <button onclick="start()">INITIALISE</button>`;
    return;
  }

  if (!s.adminConfirmed) {
    ui.innerHTML = `<h2>Waiting for admin to start the game</h2>`;
    return;
  }

  if (s.phase === "SETUP") {
    const p = s.players.find(x => !x.name);
    if (!p) {
      ui.innerHTML = `<h2>All players entered</h2>`;
      return;
    }
    ui.innerHTML = `
      <h2>PLAYER ${p.id}</h2>
      <input id="name" placeholder="Name">
      <select id="role">
        <option>FAITHFUL</option>
        <option>TRAITOR</option>
      </select><br>
      <button onclick="savePlayer(${p.id})">CONFIRM</button>`;
    return;
  }

  if (s.paused) {
    ui.innerHTML = `<h2>GAME PAUSED</h2>`;
    return;
  }

  if (s.phase === "MENU") {
    ui.innerHTML = `
      <button onclick="startGame()">GAME</button>
      <button onclick="finalBanish()">FINAL BANISHMENT</button>`;
  }

  if (s.phase === "MURDER" && s.currentPlayer) {
    const me = s.players.find(p => p.id === s.currentPlayer);
    if (me.role !== "TRAITOR") {
      nextMurder();
      return;
    }
    ui.innerHTML = `<h2>${me.name}, SELECT A PLAYER</h2>`;
    aliveFaithful().forEach(p => {
      ui.innerHTML += `<button onclick="chooseMurder(${p.id})">${p.name}</button>`;
    });
  }

  if (s.phase === "VOTE" && s.currentPlayer) {
    const me = s.players.find(p => p.id === s.currentPlayer);
    ui.innerHTML = `<h2>${me.name}, VOTE</h2>`;
    alivePlayers().forEach(p => {
      ui.innerHTML += `<button onclick="vote('${p.name}')">${p.name}</button>`;
    });
  }
}

function start() {
  initGame(
    Number(document.getElementById("count").value),
    document.getElementById("disp").checked
  );
}

function savePlayer(id) {
  const s = load();
  const p = s.players.find(x => x.id === id);
  p.name = document.getElementById("name").value;
  p.role = document.getElementById("role").value;
  save(s);
}

setInterval(render, 300);
</script>
<script src="logic.js"></script>
</body>
</html>
